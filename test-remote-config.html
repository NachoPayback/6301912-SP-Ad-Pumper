<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SP Remote Config Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid;
        }
        .success { background: #d4edda; border-color: #28a745; color: #155724; }
        .error { background: #f8d7da; border-color: #dc3545; color: #721c24; }
        .info { background: #d1ecf1; border-color: #17a2b8; color: #0c5460; }
        .config-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .webhook-test { background: #28a745; }
        .webhook-test:hover { background: #1e7e34; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß SP Remote Configuration Test</h1>
        <p>Testing remote configuration loading and Discord webhook integration.</p>
        
        <div id="status" class="status info">
            ‚è≥ Initializing test...
        </div>
        
        <div>
            <button onclick="testRemoteConfig()">üîÑ Test Remote Config</button>
            <button onclick="testDiscordWebhook()" class="webhook-test">üì¢ Test Discord Webhook</button>
            <button onclick="testAnalyticsEvent()">üìä Test Analytics Event</button>
        </div>
        
        <div id="config-display" class="config-display" style="display:none;"></div>
        
        <div id="results"></div>
    </div>

    <script>
        // Simulate the remote config loading
        class MockSPRemoteConfig {
            async getConfig() {
                try {
                    const response = await fetch('https://raw.githubusercontent.com/NachoPayback/6301912-SP-Ad-Pumper/master/config.json');
                    const config = await response.json();
                    return config;
                } catch (error) {
                    console.error('Failed to fetch remote config:', error);
                    throw error;
                }
            }
        }

        // Mock analytics for testing
        class MockSPAnalytics {
            constructor() {
                this.discordWebhook = null;
            }

            async loadConfig() {
                const remoteConfig = new MockSPRemoteConfig();
                const config = await remoteConfig.getConfig();
                this.discordWebhook = config.analytics?.webhook_url;
                return config;
            }

            async sendTestEvent() {
                if (!this.discordWebhook) {
                    throw new Error('Discord webhook not configured');
                }

                const payload = {
                    username: "SP Test Bot",
                    embeds: [{
                        title: "üß™ Remote Config Test",
                        description: "Testing Discord webhook integration from remote config!",
                        color: 0x00ff00,
                        fields: [
                            {
                                name: "‚úÖ Status",
                                value: "Remote configuration loaded successfully",
                                inline: true
                            },
                            {
                                name: "üïê Timestamp",
                                value: new Date().toLocaleString(),
                                inline: true
                            }
                        ],
                        footer: {
                            text: "SP Extension Test Suite"
                        }
                    }]
                };

                const response = await fetch(this.discordWebhook, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`Discord webhook failed: ${response.status}`);
                }

                return response;
            }
        }

        const analytics = new MockSPAnalytics();
        let currentConfig = null;

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.className = `status ${type}`;
            statusEl.innerHTML = message;
        }

        function addResult(message, type = 'info') {
            const resultsEl = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `status ${type}`;
            resultDiv.innerHTML = message;
            resultsEl.appendChild(resultDiv);
        }

        async function testRemoteConfig() {
            updateStatus('‚è≥ Loading remote configuration...', 'info');
            
            try {
                const config = await analytics.loadConfig();
                currentConfig = config;
                
                const configDisplay = document.getElementById('config-display');
                configDisplay.textContent = JSON.stringify(config, null, 2);
                configDisplay.style.display = 'block';
                
                updateStatus('‚úÖ Remote configuration loaded successfully!', 'success');
                addResult(`üì° Config Version: ${config.version || 'N/A'}`, 'success');
                addResult(`üîó Discord Webhook: ${config.analytics?.webhook_url ? 'Configured' : 'Missing'}`, 
                         config.analytics?.webhook_url ? 'success' : 'error');
                addResult(`üìä Analytics Enabled: ${config.analytics?.enabled || false}`, 'info');
                
            } catch (error) {
                updateStatus(`‚ùå Failed to load remote config: ${error.message}`, 'error');
                addResult(`Error details: ${error.message}`, 'error');
            }
        }

        async function testDiscordWebhook() {
            if (!currentConfig) {
                updateStatus('‚ö†Ô∏è Please test remote config first!', 'error');
                return;
            }

            updateStatus('üì¢ Testing Discord webhook...', 'info');
            
            try {
                await analytics.sendTestEvent();
                updateStatus('‚úÖ Discord webhook test successful! Check your Discord channel.', 'success');
                addResult('üéØ Test message sent to Discord successfully', 'success');
                
            } catch (error) {
                updateStatus(`‚ùå Discord webhook test failed: ${error.message}`, 'error');
                addResult(`Webhook error: ${error.message}`, 'error');
            }
        }

        async function testAnalyticsEvent() {
            updateStatus('üìä Testing analytics event simulation...', 'info');
            
            // Simulate a real analytics event
            const testEvent = {
                eventType: 'test_event',
                userId: 'test_user_' + Date.now(),
                domain: 'test.example.com',
                userAgent: navigator.userAgent,
                timestamp: Date.now()
            };

            addResult('üîÑ Simulated analytics event:', 'info');
            addResult(JSON.stringify(testEvent, null, 2), 'info');
            updateStatus('‚úÖ Analytics event simulation complete', 'success');
        }

        // Auto-run initial test
        window.onload = () => {
            setTimeout(() => {
                testRemoteConfig();
            }, 1000);
        };
    </script>
</body>
</html> 